include ../../mk/util.mk

SKETCHCPP_SRC := gcs_mavlink_test_unit.cpp ../../ArduCopter/GCS_Mavlink.pde

sketch:
	mkdir -p generated_files
	gawk -v mode=header '$(SKETCH_SPLITTER)'   $(SKETCHCPP_SRC) >  gcs_mavlink_test_unit.new
	@echo "#line 1 \"autogenerated\""                           >> gcs_mavlink_test_unit.new
	gawk                '$(SKETCH_PROTOTYPER)' $(SKETCHCPP_SRC) >> gcs_mavlink_test_unit.new
	gawk -v mode=body   '$(SKETCH_SPLITTER)'   $(SKETCHCPP_SRC) >> gcs_mavlink_test_unit.new
	@cmp gcs_mavlink_test_unit gcs_mavlink_test_unit.new > /dev/null 2>&1 || mv gcs_mavlink_test_unit.new gcs_mavlink_test_unit
	rm -f gcs_mavlink_test_unit.new
	mv gcs_mavlink_test_unit generated_files/gcs_mavlink_test_unit.cpp
	
build:
	g++ \
	-I ../../libraries/GCS_MAVLink/include/mavlink/v1.0/ardupilotmega/ \
	-I ../../libraries/GCS_MAVLink/include/mavlink/v1.0/ \
	-I . \
	-w -g -o generated_files/unit_tests generated_files/gcs_mavlink_test_unit.cpp test_suite.cpp
	
run:
	./generated_files/unit_tests
	
clean:
	rm -rf generated_files
	
tests: sketch build run
